node {
    stage('Initialize') {
        sh """
            echo 'Broadcast started on slack!'
            echo "${JOB_NAME} - ${BUILD_NUMBER} - ${BUILD_ID} on ${JENKINS_URL}"
        """
    }
    stage ('Checkout') {
        checkout scm
    }
    stage('Build') {
        sh """
            docker build --no-cache \
            -t ny-web -f Dockerfile .
        """
    }
    stage('Run') {
        sh """
            docker run \
            --rm \
            ny-web cp -r /usr/src/app/dist/ /app
        """
    }
    stage('Deploy') {
        sh """
            docker run \
            -v $PWD/dist:/data \
            garland/aws-cli-docker \
            aws s3 sync --acl public-read --sse --delete /data s3://ny-web-master-bucket/
        """
    }
    stage('Done') {
        sh """
            echo 'Broadcast done on slack!'
            echo "Web App: http://ny-web-master-bucket.s3-website-ap-southeast-1.amazonaws.com"
        """
    }
}